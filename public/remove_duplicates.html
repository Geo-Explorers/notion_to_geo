<!DOCTYPE html>
<html>
  <head>
    <title>Notion to Geo Publisher</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
      }
      button {
        padding: 10px 15px;
        background: #0070f3;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0051a8;
      }
      #status {
        margin-top: 20px;
      }
      .input-container {
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Remove duplicates on Geo</h1>
    <p>This is a tool to remove duplicate entities on Geo.</p>
    <div class="input-container">
      <p>Enter private key to publish news stories to Geo. Get private key at https://www.geobrowser.io/export-wallet</p>
      <input 
        type="text" 
        id="privateKey" 
        placeholder="Enter private key"
      />
    </div>
    <div class="input-container">
      <p>Enter wallet address for your Geo account (from your personal space page in property Account).</p>
      <input
        type="text"
        id="walletAddress"
        placeholder="Enter wallet address"
      />
    </div>
    <div class="input-container">
        <p>Enter the Geo ID for the entity you would like to keep</p>
        <input
            type="text"
            id="entity_to_keep"
            placeholder="Enter Geo ID for entity to keep"
        />
    </div>
    <div class="input-container">
        <p>Enter comma seperated list of Geo IDs for duplicate entities (e.g. Entity_ID_1, Entity_ID_2, ..., Entity_ID_LAST)</p>
        <input
            type="text"
            id="duplicates"
            placeholder="Enter comma seperated list of Geo IDs for any duplicate entities"
        />
    </div>
    <button id="processBtn">Publish</button>
    <div id="status"></div>

    <script>
      let isProcessing = false;
      document
        .getElementById("processBtn")
        .addEventListener("click", async () => {
          if (isProcessing) return;
          isProcessing = true;

          const statusDiv = document.getElementById("status");
          const privateKey = document.getElementById("privateKey").value;
          const walletAddress = document.getElementById("walletAddress").value;
          const entity_to_keep = document.getElementById("entity_to_keep").value;
          const duplicates = document.getElementById("duplicates").value;

          if (!privateKey.trim()) {
            statusDiv.innerHTML =
              '<p style="color: red;">❌ Please enter a private key</p>';
            isProcessing = false;
            return;
          }

          if (!walletAddress.trim()) {
            statusDiv.innerHTML =
              '<p style="color: red;">❌ Please enter a wallet address</p>';
            isProcessing = false;
            return;
          }

          if (!entity_to_keep.trim()) {
            statusDiv.innerHTML =
              '<p style="color: red;">❌ Please enter a valid Geo ID for the entity to keep</p>';
            isProcessing = false;
            return;
          }

          if (!duplicates.trim()) {
            statusDiv.innerHTML =
              '<p style="color: red;">❌ Please enter a valid list of duplicate entity IDs</p>';
            isProcessing = false;
            return;
          }

          statusDiv.innerHTML = "Processing duplicates...";

          try {
            const response = await fetch("/remove_duplicates", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ privateKey, walletAddress, entity_to_keep, duplicates }),
            });
            const result = await response.json();

            if (result.success) {
              statusDiv.innerHTML = `<p style="color: green;">✅ ${result.message}</p>`;
            } else {
              statusDiv.innerHTML = `<p style="color: red;">❌ ${result.message}</p>`;
            }
          } catch (error) {
            statusDiv.innerHTML =
              '<p style="color: red;">❌ An error occurred. Please check the server logs.</p>';
          } finally {
            isProcessing = false;
          }
        });
    </script>
  </body>
</html>
